- name: Set up Node.js
  uses: actions/setup-node@v3
  with:
    node-version: 20

- name: Install Playwright and Dependencies
  run: npx playwright install --with-deps chromium firefox

- name: Install Allure Command Line and Allure-Playwright adapter
  run: npm install allure-commandline allure-playwright --save-dev

- name: Install Faker
  run: npm install @faker-js/faker --save-dev

- name: Copy Allure Report Data
  run: |
    mkdir -p $GITHUB_WORKSPACE/allure-report
    cp -r $GITHUB_WORKSPACE/allure-results/* $GITHUB_WORKSPACE/allure-report/

- name: Set Git User
  run: |
    git config --global user.email "serge.karpov@gmail.com"
    git config --global user.name "SHIRO SAN"

- name: Push Report to Another Branch
  run: |
    git checkout -b allure-report
    git add -A
    git commit -m "Add Allure report"
    git push --force origin allure-report
  env:
    PAT: ${{ secrets.MY_SECRET_CAT }}

- name: Configure GitHub Pages
  run: |
    # Create or switch to the gh-pages branch
    git checkout -b gh-pages

    # Remove existing content (if any)
    git rm -r .

    # Move the allure-report directory to docs
    mv -f $GITHUB_WORKSPACE/allure-report $GITHUB_WORKSPACE/docs

    # Commit the changes
    git add -A
    git commit -m "Publish Allure report to GitHub Pages"

    # Push the changes to the gh-pages branch
    git push --force origin gh-pages
